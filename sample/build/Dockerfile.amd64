FROM kanap0nta/gocv:amd64-latest as build

WORKDIR /app
COPY . .
RUN GOOS=linux GOARCH=amd64 CGO_ENABLED=1 CXX=/usr/bin/g++ CC=/usr/bin/gcc go build "-ldflags=-s -w -buildid=" -trimpath -o ./bin/captest ./cmd/captest/main.go


FROM debian:bullseye-slim

WORKDIR /app
COPY --from=build /app/bin/captest .

CMD ["./captest"]