FROM kanap0nta/gocv:arm64-latest as build

WORKDIR /app
COPY . .
RUN GOOS=linux GOARCH=arm64 CGO_ENABLED=1 CXX=/usr/bin/g++ CC=/usr/bin/gcc go build -tags customenv "-ldflags=-s -w -buildid=" -trimpath -o ./bin/captest ./cmd/captest/main.go


FROM arm64v8/debian:bullseye-slim

WORKDIR /app
COPY --from=build /app/bin/captest .

CMD ["./captest"]